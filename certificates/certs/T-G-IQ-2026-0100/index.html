<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Certificate | T-G-IQ-2026-0100</title>

  <!-- Shared brand CSS (repo root /branding/) -->
  <link rel="stylesheet" href="../../../branding/brand.css" />

  <style>
    /* Print: A4 landscape certificate */
    @page { size: A4 landscape; margin: 10mm; }
    @media print {
      .toolbar { display: none !important; }
      body { background: #fff !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .sheet { box-shadow: none !important; margin: 0 !important; }
      a { color: inherit; text-decoration: none; }
      img { image-rendering: auto; }
    }

    /* Screen backdrop */
    body { background: #f4f6f8; }

    .toolbar{
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      gap: 12px;
      justify-content: center;
      padding: 12px;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid #e9e9e9;
    }

    /* A4 landscape usable canvas */
    .sheet{
      width: 277mm;
      height: 190mm;
      margin: 18px auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    /* Certificate frame */
    .frame{
      position: absolute;
      inset: 10mm;
      border-radius: 18px;
      border: 2.5mm solid var(--primary);
      box-sizing: border-box;
    }
    .frame::after{
      content:"";
      position: absolute;
      inset: 6mm;
      border-radius: 14px;
      border: 1px solid rgba(17,17,17,0.15);
    }

    .inner{
      position: relative;
      height: 100%;
      box-sizing: border-box;                 /* critical: padding stays inside height */
      padding: 18mm 18mm 44mm 18mm;           /* reduced bottom padding since QR is now floating */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      text-align: center;
      z-index: 2;                              /* content above frame */
    }

    .brandRow{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brandLeft{
      display: flex;
      align-items: center;
      gap: 14px;
      text-align: left;
    }

    .brandName{
      margin: 0;
      font-weight: 900;
      font-size: 18px;
      letter-spacing: -0.3px;
      color: var(--grey-600);
    }
    .brandSub{
      margin: 3px 0 0;
      font-size: 13px;
      font-weight: 600;
      color: rgba(17,17,17,0.75);
    }

    .chipSmall{
      font-size: 12px;
      font-weight: 900;
      padding: 8px 14px;
      border-radius: 999px;
      background: var(--lime);
      color: #0B1A0B;
      border: 1px solid rgba(0,0,0,0.08);
      letter-spacing: 0.4px;
      white-space: nowrap;
    }

    .title{
      margin-top: 8mm;
      font-size: 34px;
      font-weight: 900;
      letter-spacing: -0.8px;
      color: var(--grey-600);
    }
    .subtitle{
      margin-top: 2mm;
      font-size: 14px;
      color: rgba(17,17,17,0.72);
      font-weight: 600;
    }

    .name{
      margin-top: 10mm;
      font-size: 44px;
      font-weight: 900;
      letter-spacing: -0.8px;
      color: var(--grey-600);
    }
    .nameLine{
      width: 165mm;
      margin: 3mm auto 0;
      border-top: 0.6mm solid rgba(17,17,17,0.18);
    }

    .courseBlock{
      margin-top: 10mm;
      color: rgba(17,17,17,0.72);
      font-size: 16px;
      line-height: 1.5;
      padding: 0 12mm;
    }
    .course{
      margin-top: 4mm;
      font-size: 22px;
      font-weight: 900;
      color: var(--grey-600);
    }

    .footer{
      display: flex;
      justify-content: space-between;
      gap: 12mm;
      align-items: flex-end;
      margin-top: 10mm;
      text-align: left;
    }

    .sig{
      width: 90mm;
      font-size: 12px;
      color: rgba(17,17,17,0.75);
    }
    .sigLine{
      border-top: 0.5mm solid rgba(17,17,17,0.35);
      margin-bottom: 3mm;
    }
    .sig strong{ color: var(--grey-600); }

    .meta{
      width: 120mm;
      font-size: 12px;
      color: rgba(17,17,17,0.75);
      text-align: right;
    }
    .meta div{ margin: 2mm 0; }
    .meta strong{ color: var(--grey-600); }

    .disclaimer{
      margin-top: 6mm;
      font-size: 11px;
      color: rgba(17,17,17,0.62);
      text-align: center; /* CSS uses US spelling */
    }

    /* Icon image (uses your existing .icon container style) */
    .icon img{
      width: 28px;
      height: 28px;
      display: block;
    }

    /* Keep the verification link tidy (we only show id=...) */
    #verifyLink{
      color: inherit;
      text-decoration: underline;
      word-break: break-word;
    }

    /* Floating QR: does NOT affect footer layout */
    .qrFloat{
      position: absolute;
      left: 50%;
      bottom: 20mm;                 /* sits inside the frame */
      transform: translateX(-50%);
      z-index: 3;                   /* above frame and content */
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2mm;
      pointer-events: none;         /* avoids odd selection; QR still scans in images/PDF */
    }
    .qrLabel{
      font-size: 11px;
      font-weight: 800;
      color: rgba(17,17,17,0.75);
      letter-spacing: 0.2px;
    }
    .qr{
      width: 28mm;                  /* LinkedIn-safe size */
      height: 28mm;
      border: 1px solid rgba(17,17,17,0.15);
      border-radius: 8px;
      background: #fff;
      padding: 2mm;
      box-sizing: border-box;
    }
    .qr img{
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>

<body>
  <div class="toolbar">
    <button class="btn btnPrimary" onclick="window.print()">Print / Save as PDF</button>
    <a id="verifyBtn" class="btn btnSecondary" href="../../verify/?id=T-G-IQ-2026-0100">Verify this ID</a>
  </div>

  <main class="sheet" role="document" aria-label="Certificate of Completion">
    <div class="frame" aria-hidden="true"></div>

    <!-- Floating QR (centred, doesn’t push the footer around) -->
    <div class="qrFloat" aria-label="QR code for verification">
      <div class="qrLabel">Scan to verify</div>
      <div class="qr">
        <img id="qrImg" alt="Scan to verify this certificate" />
      </div>
    </div>

    <div class="inner">
      <!-- Top content -->
      <div>
        <div class="brandRow">
          <div class="brandLeft">
            <div class="icon" aria-hidden="true">
              <img src="../../../branding/Trident-G-Icon.svg" alt="" />
            </div>
            <div>
              <p class="brandName">Trident-G IQ · IQ Mindware</p>
              <p class="brandSub">Certificate Registry</p>
            </div>
          </div>

          <div class="chipSmall">
            Credential ID: <span id="certId">T-G-IQ-2026-0100</span>
          </div>
        </div>

        <div class="title">Certificate of Completion</div>
        <div class="subtitle">This certifies successful completion of the programme below.</div>

        <div class="name" id="certName">Raj Gaurav</div>
        <div class="nameLine"></div>

        <div class="courseBlock">
          has completed the requirements for:
          <div class="course" id="certCourse">24 Day Cognitive Training Programme</div>
          <div style="margin-top:4mm;">
            Issued as a record of completion.
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div>
        <div class="footer">
          <div class="sig">
            <div class="sigLine"></div>
            <div><strong>Dr Mark Ashton Smith</strong></div>
            <div>Director, Mindware Lab; University of Essex, Online</div>
          </div>

          <div class="meta">
            <div><strong>Issue date:</strong> <span id="issueDate">2026-02-12</span></div>
            <div><strong>Programme:</strong> <span id="issuerName">IQ Mindware / Trident-G IQ</span></div>
            <div>
              <strong>Verification:</strong>
              <a id="verifyLink" href="../../verify/?id=T-G-IQ-2026-0100">id=T-G-IQ-2026-0100</a>
            </div>
          </div>
        </div>

        <div class="disclaimer">
          Supports healthy habits and learning. Not medical advice. If concerned about health, consult your GP.
        </div>
      </div>
    </div>
  </main>

  <script>
    function getCertIdFromPath() {
      // Expected GitHub Pages path:
      // /<repo>/certificates/certs/<CERT_ID>/
      const parts = window.location.pathname.split("/").filter(Boolean);
      const i = parts.lastIndexOf("certs");
      if (i >= 0 && parts[i + 1]) return decodeURIComponent(parts[i + 1]);
      return null;
    }

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el && value !== undefined && value !== null && value !== "") {
        el.textContent = value;
      }
    }

    async function hydrateCertificate() {
      const certId =
        getCertIdFromPath() ||
        document.getElementById("certId")?.textContent?.trim() ||
        "T-G-IQ-2026-0100";

      // Update ID everywhere immediately
      setText("certId", certId);
      document.title = `Certificate | ${certId}`;

      // Build absolute verification URL (prevents showing ../../ in the PDF)
      const verifyUrl = new URL(`../../verify/?id=${encodeURIComponent(certId)}`, window.location.href);

      const verifyLink = document.getElementById("verifyLink");
      if (verifyLink) {
        verifyLink.href = verifyUrl.toString();
        verifyLink.textContent = `id=${certId}`;      // only show the ID (still clickable)
        verifyLink.title = verifyUrl.toString();      // full URL on hover
      }

      const verifyBtn = document.getElementById("verifyBtn");
      if (verifyBtn) {
        verifyBtn.href = verifyUrl.toString();
      }

      // QR code (big enough for LinkedIn)
      const qrImg = document.getElementById("qrImg");
      if (qrImg) {
        const qrData = encodeURIComponent(verifyUrl.toString());
        qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=${qrData}`;
      }

      // Load registry data (same source as your verifier page)
      const res = await fetch("../../verify/certs.json", { cache: "no-store" });
      if (!res.ok) return;

      const data = await res.json();
      const cert = data?.certs?.[certId];

      // Only hydrate if found and valid
      if (!cert) return;
      if (cert.status && String(cert.status).toLowerCase() !== "valid") return;

      setText("certName", cert.name);
      setText("certCourse", cert.course);
      setText("issueDate", cert.issued);
      setText("issuerName", data.issuer || "IQ Mindware / Trident-G IQ");
    }

    hydrateCertificate().catch(console.error);
  </script>
</body>
</html>

